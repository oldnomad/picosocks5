image: debian:stable-slim

stages:
  - build
  - release

build-proj:
  stage: build
  script:
    - apt-get update -qq
    - apt-get install -y -qq build-essential autoconf automake pkg-config libssl-dev
    - autoconf --version
    - automake --version
    - gcc --version
    - pkg-config --modversion libssl
    - autoreconf -f -i -Wall
    - ./configure
    - make

package-proj:
  stage: release
  script:
    - apt-get update -qq
    - apt-get install -y -qq build-essential autoconf automake pkg-config libssl-dev debhelper
    - autoreconf -f -i -Wall
    - dpkg-buildpackage -us -uc
    - mkdir build
    - mv ../picosocks5*.deb build/
  only:
    - tags
  artifacts:
    name: "picosocks5-$CI_COMMIT_TAG"
    paths:
      - build/*
